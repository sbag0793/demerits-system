{% extends 'base.html' %}
{% block content %}
{{ a, error_list }}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.student_child').forEach(function(student) {
      student.addEventListener('click', function(event) {
        event.preventDefault();

// 이미 클릭된 학생이면 아무 작업도 하지 않음
        if (this.classList.contains('disabled')) {
          return;
        }

        const studentName = this.getAttribute('data-name');
        const studentId = this.getAttribute('data-id');
        // 확인용 콘솔 로그
        console.log('studentName:', studentName);
        console.log('studentId:', studentId);
        
        const listItem = document.createElement('div');
        listItem.textContent = studentName;
        document.getElementById('addStudents').appendChild(listItem);
        const studentList = document.querySelector('#addStudents');
        if (studentList) {
          studentList.appendChild(listItem);
          // 학생 행을 비활성화 상태로 만듦
          this.classList.add('disabled');
        } else {
          console.error('Student list not found');
        }
      });
    });
  });
  document.getElementById('grantScore').addEventListener('click', function(event) {
    event.preventDefault();

    const form = document.getElementById('scoreForm');
    const formData = new FormData(form);

    const data = {
      teacherId: formData.get('teacherId'),
      studentIds: selectedStudents,
      type: formData.get('studentId'),
      score: formData.get('studentId'),
      reason: formData.get('studentId'),
      };

    fetch('/event', {
      method: 'POST',
      headers: {
          'Content-Type': 'application/json'
        },
      body: JSON.stringify(data)
    })
      .then(response => response.json())
      .then(data => {
          console.log('Success:', data);
        })
      .catch((error) => {
          console.error('Error:', error);
        });
  });
</script>
<link rel="stylesheet" href="{{ url_for('static', filename='event.css') }}">
<section class="container">
  <div class="child search">
    <div class="left">
      <div class="form">
        <form method="post" class="post-form" name="studentSelectForm">
          <input type="hidden" name="student" value=""> 
          <!-- student -->
          <div class="gradeclass">
            <div class="grade">
              <select class="form-select" id="studentSelect" name="grade">
                <option value=1>1학년</option>
                <option value=2>2학년</option>
                <option value=3>3학년</option>
              </select>
            </div>
            <!-- Class -->
            <div class="Class form-floating">
              <input type="number" name="Class" class="form-control" id="ClassInput" placeholder="Class">
              <label for="ClassInput">반</label>
            </div>
          </div>
          <!-- submit -->
          <input type="submit" class="form-control btn btn-primary" name="requestStudents" value="학생 검색">
        </form>
      </div>
      <div id="addStudents">

      </div>
    </div>
    <div class="border viewer right">
      <table class="table">
        <thead>
          <tr>
            <a href=""><th scope="col">#</th></a>
            <th scope="col">grade</th>
            <th scope="col">class</th>
            <th scope="col">number</th>
            <th scope="col">name</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% if student_list %}
            {% for student in student_list %}
              {% if loop.index > 10 %}
                {% break %}
              {% endif %}
              <tr>
                <th scope="row">{{ loop.revindex }}</th>
                <td>{{ student.grade }}학년</td>
                <td>{{ student.Class }}반</td>
                <td>{{ student.number }}번</td>
                <td><a class="student_child" href="/event" data-name="{{ student.name }}" data-id="{{ loop.index }}">{{ student.name }}</a></td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="text-body-secondary">등록된 학생이 없습니다.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
    <!-- <div class="table">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">grade</th>
            <th scope="col">class</th>
            <th scope="col">number</th>
            <th scope="col">name</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% if student_list %}
            {% for student in student_list %}
              <tr>
                <th scope="row">{{ loop.revindex }}</th>
                <td>{{ student.grade }}학년</td>
                <td>{{ student.Class }}반</td>
                <td>{{ student.number }}번</td>
                <td>{{ student.name }}</td>
              </tr>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="5" class="text-body-secondary">검색된 학생이 없습니다.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div> -->
  </div>
  <div class="child grant">
    <form method="post" name="scoreForm" class="post-form child">
      <!-- variables -->
      <input type="hidden" name="teacherId" value="1">
      <input type="hidden" name="studentIds" value="1">
      <!-- type -->
      <div class="type">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="type" id="typeRadio1" value="True">
          <label class="form-check-label" for="typeRadio1">상점</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name='type' id="typeRadio2" value="False">
          <label class="form-check-label" for="typeRadio2">벌점</label>
        </div>
      </div>
      <!-- score -->
      <div class="score form-floating">
        <input type="number" class="form-control" name="score" id="scoreNumber" placeholder="score">
        <label for="scoreNumber">부여할 점수</label>
      </div>
      <!-- reason -->
      <div class="reason">
        <select class="form-select" id="reasonSelect" name="reason">
          {% for reason in reason_list %}
            <option value="{{ loop.index }}">{{ reason }}</option>
          {% endfor %}
        </select>
      </div>
      <!-- submit -->
      <input type="submit" class="form-control btn btn-primary" name="grantScore" value="점수 부여" id="grantScore">
    </form>
  </div>
</section>
{% endblock %}